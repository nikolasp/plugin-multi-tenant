import { combineWhereConstraints } from "./combineWhereConstraints";
import { getTenantAccess } from "./getTenantAccess";
export const withTenantAccess = ({ accessFunction, fieldName, userHasAccessToAllTenants })=>async (args)=>{
        const constraints = [];
        const accessFn = typeof accessFunction === 'function' ? accessFunction : ({ req })=>Boolean(req.user);
        const accessResult = await accessFn(args);
        if (accessResult === false) {
            return false;
        } else if (accessResult && typeof accessResult === 'object') {
            constraints.push(accessResult);
        }
        if (args.req.user && !userHasAccessToAllTenants(args.req.user)) {
            constraints.push(getTenantAccess({
                fieldName,
                user: args.req.user
            }));
            return combineWhereConstraints(constraints);
        }
        return accessResult;
    };

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvd2l0aFRlbmFudEFjY2Vzcy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgdHlwZSB7IEFjY2VzcywgQWNjZXNzQXJncywgQWNjZXNzUmVzdWx0LCBVc2VyIH0gZnJvbSAncGF5bG9hZCdcblxuaW1wb3J0IHR5cGUgeyBNdWx0aVRlbmFudFBsdWdpbkNvbmZpZywgVXNlcldpdGhUZW5hbnRzRmllbGQgfSBmcm9tICcuLi90eXBlcydcblxuaW1wb3J0IHsgY29tYmluZVdoZXJlQ29uc3RyYWludHMgfSBmcm9tICcuL2NvbWJpbmVXaGVyZUNvbnN0cmFpbnRzJ1xuaW1wb3J0IHsgZ2V0VGVuYW50QWNjZXNzIH0gZnJvbSAnLi9nZXRUZW5hbnRBY2Nlc3MnXG5cbnR5cGUgQXJnczxDb25maWdUeXBlPiA9IHtcbiAgYWNjZXNzRnVuY3Rpb24/OiBBY2Nlc3NcbiAgZmllbGROYW1lOiBzdHJpbmdcbiAgdXNlckhhc0FjY2Vzc1RvQWxsVGVuYW50czogUmVxdWlyZWQ8XG4gICAgTXVsdGlUZW5hbnRQbHVnaW5Db25maWc8Q29uZmlnVHlwZT5cbiAgPlsndXNlckhhc0FjY2Vzc1RvQWxsVGVuYW50cyddXG59XG5leHBvcnQgY29uc3Qgd2l0aFRlbmFudEFjY2VzcyA9XG4gIDxDb25maWdUeXBlPih7IGFjY2Vzc0Z1bmN0aW9uLCBmaWVsZE5hbWUsIHVzZXJIYXNBY2Nlc3NUb0FsbFRlbmFudHMgfTogQXJnczxDb25maWdUeXBlPikgPT5cbiAgYXN5bmMgKGFyZ3M6IEFjY2Vzc0FyZ3MpOiBQcm9taXNlPEFjY2Vzc1Jlc3VsdD4gPT4ge1xuICAgIGNvbnN0IGNvbnN0cmFpbnRzID0gW11cbiAgICBjb25zdCBhY2Nlc3NGbiA9XG4gICAgICB0eXBlb2YgYWNjZXNzRnVuY3Rpb24gPT09ICdmdW5jdGlvbidcbiAgICAgICAgPyBhY2Nlc3NGdW5jdGlvblxuICAgICAgICA6ICh7IHJlcSB9OiBBY2Nlc3NBcmdzKTogQWNjZXNzUmVzdWx0ID0+IEJvb2xlYW4ocmVxLnVzZXIpXG4gICAgY29uc3QgYWNjZXNzUmVzdWx0OiBBY2Nlc3NSZXN1bHQgPSBhd2FpdCBhY2Nlc3NGbihhcmdzKVxuXG4gICAgaWYgKGFjY2Vzc1Jlc3VsdCA9PT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBmYWxzZVxuICAgIH0gZWxzZSBpZiAoYWNjZXNzUmVzdWx0ICYmIHR5cGVvZiBhY2Nlc3NSZXN1bHQgPT09ICdvYmplY3QnKSB7XG4gICAgICBjb25zdHJhaW50cy5wdXNoKGFjY2Vzc1Jlc3VsdClcbiAgICB9XG5cbiAgICBpZiAoXG4gICAgICBhcmdzLnJlcS51c2VyICYmXG4gICAgICAhdXNlckhhc0FjY2Vzc1RvQWxsVGVuYW50cyhcbiAgICAgICAgYXJncy5yZXEudXNlciBhcyBDb25maWdUeXBlIGV4dGVuZHMgeyB1c2VyOiB1bmtub3duIH0gPyBDb25maWdUeXBlWyd1c2VyJ10gOiBVc2VyLFxuICAgICAgKVxuICAgICkge1xuICAgICAgY29uc3RyYWludHMucHVzaChcbiAgICAgICAgZ2V0VGVuYW50QWNjZXNzKHtcbiAgICAgICAgICBmaWVsZE5hbWUsXG4gICAgICAgICAgdXNlcjogYXJncy5yZXEudXNlciBhcyBVc2VyV2l0aFRlbmFudHNGaWVsZCxcbiAgICAgICAgfSksXG4gICAgICApXG4gICAgICByZXR1cm4gY29tYmluZVdoZXJlQ29uc3RyYWludHMoY29uc3RyYWludHMpXG4gICAgfVxuXG4gICAgcmV0dXJuIGFjY2Vzc1Jlc3VsdFxuICB9XG4iXSwibmFtZXMiOlsiY29tYmluZVdoZXJlQ29uc3RyYWludHMiLCJnZXRUZW5hbnRBY2Nlc3MiLCJ3aXRoVGVuYW50QWNjZXNzIiwiYWNjZXNzRnVuY3Rpb24iLCJmaWVsZE5hbWUiLCJ1c2VySGFzQWNjZXNzVG9BbGxUZW5hbnRzIiwiYXJncyIsImNvbnN0cmFpbnRzIiwiYWNjZXNzRm4iLCJyZXEiLCJCb29sZWFuIiwidXNlciIsImFjY2Vzc1Jlc3VsdCIsInB1c2giXSwibWFwcGluZ3MiOiJBQUlBLFNBQVNBLHVCQUF1QixRQUFRLDRCQUEyQjtBQUNuRSxTQUFTQyxlQUFlLFFBQVEsb0JBQW1CO0FBU25ELE9BQU8sTUFBTUMsbUJBQ1gsQ0FBYSxFQUFFQyxjQUFjLEVBQUVDLFNBQVMsRUFBRUMseUJBQXlCLEVBQW9CLEdBQ3ZGLE9BQU9DO1FBQ0wsTUFBTUMsY0FBYyxFQUFFO1FBQ3RCLE1BQU1DLFdBQ0osT0FBT0wsbUJBQW1CLGFBQ3RCQSxpQkFDQSxDQUFDLEVBQUVNLEdBQUcsRUFBYyxHQUFtQkMsUUFBUUQsSUFBSUUsSUFBSTtRQUM3RCxNQUFNQyxlQUE2QixNQUFNSixTQUFTRjtRQUVsRCxJQUFJTSxpQkFBaUIsT0FBTztZQUMxQixPQUFPO1FBQ1QsT0FBTyxJQUFJQSxnQkFBZ0IsT0FBT0EsaUJBQWlCLFVBQVU7WUFDM0RMLFlBQVlNLElBQUksQ0FBQ0Q7UUFDbkI7UUFFQSxJQUNFTixLQUFLRyxHQUFHLENBQUNFLElBQUksSUFDYixDQUFDTiwwQkFDQ0MsS0FBS0csR0FBRyxDQUFDRSxJQUFJLEdBRWY7WUFDQUosWUFBWU0sSUFBSSxDQUNkWixnQkFBZ0I7Z0JBQ2RHO2dCQUNBTyxNQUFNTCxLQUFLRyxHQUFHLENBQUNFLElBQUk7WUFDckI7WUFFRixPQUFPWCx3QkFBd0JPO1FBQ2pDO1FBRUEsT0FBT0s7SUFDVCxFQUFDIn0=